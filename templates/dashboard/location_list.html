{% extends "base.html" %}

{% block title %}Locations - {{ service.name }} - shymini{% endblock %}

{% block content %}
<div class="mb-6 flex justify-between items-center">
    <div>
        <a href="/service/{{ service.id }}" class="text-indigo-600 hover:underline text-sm">‚Üê Back to {{ service.name }}</a>
        <h1 class="text-2xl font-bold text-gray-900 mt-2">All Locations</h1>
    </div>
    <div class="flex items-center space-x-2">
        <input type="datetime-local" id="startDate" name="startDate" value="{{ start_date }}"
               class="border rounded px-3 py-2 text-sm"
               onchange="validateDateRange()">
        <span class="text-gray-500">to</span>
        <input type="datetime-local" id="endDate" name="endDate" value="{{ end_date }}"
               class="border rounded px-3 py-2 text-sm"
               onchange="validateDateRange()">
        <span id="dateError" class="text-red-500 text-xs hidden">Invalid range</span>
        <button onclick="updateDateRange()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
            Filter
        </button>
    </div>
</div>

<div class="bg-white rounded-lg shadow">
    <div class="p-4">
        {% if locations.is_empty() %}
        <p class="text-gray-500 text-center py-4">No locations found</p>
        {% else %}
        <table class="w-full">
            <thead class="text-xs text-gray-500 uppercase border-b">
                <tr>
                    <th class="text-left py-2">Location</th>
                    <th class="text-right py-2">Hits</th>
                </tr>
            </thead>
            <tbody class="text-sm">
                {% for loc in locations %}
                <tr class="border-t">
                    <td class="py-2">{{ loc.value }}</td>
                    <td class="py-2 text-right text-gray-600">{{ loc.count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</div>

<script>
function validateDateRange() {
    const startInput = document.getElementById('startDate');
    const endInput = document.getElementById('endDate');
    const errorSpan = document.getElementById('dateError');

    if (startInput.value && endInput.value) {
        const start = new Date(startInput.value);
        const end = new Date(endInput.value);

        if (start >= end) {
            errorSpan.classList.remove('hidden');
            startInput.classList.add('border-red-500');
            endInput.classList.add('border-red-500');
        } else {
            errorSpan.classList.add('hidden');
            startInput.classList.remove('border-red-500');
            endInput.classList.remove('border-red-500');
        }
    }
}

function updateDateRange() {
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    window.location.href = `/service/{{ service.id }}/locations?startDate=${start}&endDate=${end}`;
}

// Run validation on page load
document.addEventListener('DOMContentLoaded', validateDateRange);
</script>
{% endblock %}
