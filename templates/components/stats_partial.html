<!-- Stats Cards -->
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
    <div class="stat-card">
        <p class="text-xs text-gray-500 uppercase">Sessions</p>
        <p class="text-2xl font-bold text-gray-900">{{ stats.session_count }}</p>
    </div>
    <div class="stat-card">
        <p class="text-xs text-gray-500 uppercase">Hits</p>
        <p class="text-2xl font-bold text-gray-900">{{ stats.hit_count }}</p>
    </div>
    <div class="stat-card">
        <p class="text-xs text-gray-500 uppercase">Load Time</p>
        <p class="text-2xl font-bold text-gray-900">{% match stats.avg_load_time %}{% when Some with (v) %}{{ v }}ms{% when None %}?{% endmatch %}</p>
    </div>
    <div class="stat-card">
        <p class="text-xs text-gray-500 uppercase">Bounce Rate</p>
        <p class="text-2xl font-bold text-gray-900">{% match stats.bounce_rate_pct %}{% when Some with (v) %}{{ v }}%{% when None %}?{% endmatch %}</p>
    </div>
    <div class="stat-card">
        <p class="text-xs text-gray-500 uppercase">Duration</p>
        <p class="text-2xl font-bold text-gray-900">{% match stats.avg_session_duration %}{% when Some with (v) %}{{ v }}s{% when None %}?{% endmatch %}</p>
    </div>
    <div class="stat-card">
        <p class="text-xs text-gray-500 uppercase">Hits/Session</p>
        <p class="text-2xl font-bold text-gray-900">{% match stats.avg_hits_per_session %}{% when Some with (v) %}{{ v }}{% when None %}?{% endmatch %}</p>
    </div>
</div>

<!-- Chart -->
<div class="bg-white rounded-lg shadow p-4 mb-6">
    <div id="chart"></div>
</div>

<script>
(function() {
    // Destroy existing chart if present to prevent memory leaks
    if (window.shyminiChart) {
        window.shyminiChart.destroy();
        window.shyminiChart = null;
    }

    var chartData = {
        labels: [{% for label in stats.chart_data.labels %}"{{ label }}"{% if !loop.last %},{% endif %}{% endfor %}],
        sessions: [{% for s in stats.chart_data.sessions %}{{ s }}{% if !loop.last %},{% endif %}{% endfor %}],
        hits: [{% for h in stats.chart_data.hits %}{{ h }}{% if !loop.last %},{% endif %}{% endfor %}]
    };

    if (chartData.labels && chartData.labels.length > 0) {
        var options = {
            series: [
                { name: 'Sessions', data: chartData.sessions },
                { name: 'Hits', data: chartData.hits }
            ],
            chart: {
                type: 'area',
                height: 300,
                toolbar: { show: false },
                zoom: { enabled: false }
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth', width: 2 },
            fill: {
                type: 'gradient',
                gradient: { opacityFrom: 0.4, opacityTo: 0.1 }
            },
            xaxis: {
                categories: chartData.labels,
                labels: {
                    rotate: -45,
                    rotateAlways: true
                }
            },
            yaxis: { min: 0 },
            colors: ['#6366f1', '#10b981'],
            legend: { position: 'top' }
        };

        window.shyminiChart = new ApexCharts(document.querySelector("#chart"), options);
        window.shyminiChart.render();
    }
})();
</script>
